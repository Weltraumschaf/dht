<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>Help.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">DHT</a> &gt; <a href="index.source.html" class="el_package">de.weltraumschaf.dht.cmd</a> &gt; <span class="el_source">Help.java</span></div><h1>Help.java</h1><pre class="source lang-java linenums">/*
 *  LICENSE
 *
 * &quot;THE BEER-WARE LICENSE&quot; (Revision 43):
 * &quot;Sven Strittmatter&quot; &lt;weltraumschaf@googlemail.com&gt; wrote this file.
 * As long as you retain this notice you can do whatever you want with
 * this stuff. If we meet some day, and you think this stuff is worth it,
 * you can buy me a non alcohol-free beer in return.
 *
 * Copyright (C) 2012 &quot;Sven Strittmatter&quot; &lt;weltraumschaf@googlemail.com&gt;
 */
package de.weltraumschaf.dht.cmd;

import de.weltraumschaf.dht.Application;
import de.weltraumschaf.dht.shell.CommandArgumentExcpetion;
import de.weltraumschaf.dht.shell.CommandMainType;
import static de.weltraumschaf.dht.shell.CommandMainType.HELP;
import de.weltraumschaf.dht.shell.CommandRuntimeException;
import de.weltraumschaf.dht.shell.CommandSubType;
import org.apache.commons.lang3.StringUtils;
import org.apache.commons.lang3.Validate;
import org.apache.commons.lang3.text.WordUtils;

/**
 * Executes `help` command.
 *
 * @author @author Sven Strittmatter &lt;weltraumschaf@googlemail.com&gt;
 */
<span class="nc" id="L29">final class Help extends BaseCommand {</span>

    /**
     * Usage strings (left column) width.
     */
    private static final int USAGE_WIDTH = 34;
    /**
     * Max width of help output.
     */
    private static final int MAX_WIDTH = 80;
    /**
     * Description strings (right column) width.
     */
    private static final int DESCRIPTION_WIDTH = MAX_WIDTH - USAGE_WIDTH;
    /**
     * Used new line character.
     */
    private static final String NL = Application.NL;
    /**
     * First line of help.
     */
    private static final String HEADLINE_FORMAT = &quot;This is the %s interactive shell version %s.&quot;;

    @Override
    public void execute() {
<span class="nc bnc" id="L54" title="All 2 branches missed.">        if (getSubCommand() != CommandSubType.NONE) {</span>
<span class="nc" id="L55">            commandHelp(getSubCommand().toString());</span>
        } else {
<span class="nc" id="L57">            completeHelp();</span>
        }
<span class="nc" id="L59">    }</span>

    private void completeHelp() throws RuntimeException {
<span class="nc" id="L62">        final StringBuilder buffer = new StringBuilder();</span>
<span class="nc" id="L63">        buffer.append(String.format(HEADLINE_FORMAT, Application.NAME, getApplication().getVersion()))</span>
                .append(NL).append(NL);
<span class="nc" id="L65">        buffer.append(&quot;Available commands:&quot;).append(NL).append(NL);</span>

        try {
<span class="nc bnc" id="L68" title="All 2 branches missed.">            for (final Descriptor descriptor : CommandFactory.getDescriptors()) {</span>
<span class="nc" id="L69">                buffer.append(format(descriptor)).append(NL);</span>
<span class="nc" id="L70">            }</span>
<span class="nc" id="L71">        } catch (final ClassNotFoundException | InstantiationException | IllegalAccessException ex) {</span>
<span class="nc" id="L72">            throw new CommandRuntimeException(&quot;Can't get descriptors!&quot;, ex);</span>
<span class="nc" id="L73">        }</span>

<span class="nc" id="L75">        print(buffer.toString());</span>
<span class="nc" id="L76">    }</span>

    @Override
    public Descriptor getDescriptor() {
<span class="nc" id="L80">        return new BaseDescriptor() {</span>

            @Override
            public CommandMainType getCommand() {
<span class="nc" id="L84">                return HELP;</span>
            }

            @Override
            public String getUsage() {
<span class="nc" id="L89">                return &quot;help [command]&quot;;</span>
            }

            @Override
            public String getHelpDescription() {
<span class="nc" id="L94">                return &quot;Show all available commands. If theoptional command argument is given the help for that &quot;</span>
                    + &quot;argument will be shown.&quot;;
            }
        };
    }

    /**
     * Prefix usage with two spaces and pad right side up to {@link #USAGE_WIDTH}.
     *
     * @param usage must not be {@code null} or empty
     * @return never {@code nul} or empty
     */
    static String padUsage(final String usage) {
<span class="fc" id="L107">        return StringUtils.rightPad(&quot;  &quot; + Validate.notEmpty(usage), USAGE_WIDTH);</span>
    }

    /**
     * Wraps given description so it fits in a &quot;column&quot; with {@link #DESCRIPTION_WIDTH width}.
     *
     * @param usage must not be {@code null} or empty
     * @return never {@code nul} or empty
     */
    static String wrap(final String description) {
<span class="fc" id="L117">        return WordUtils.wrap(Validate.notEmpty(description), DESCRIPTION_WIDTH, NL, true);</span>
    }

    /**
     * Formats whole descriptor.
     *
     * @param descriptor must not be {@code null}
     * @return never {@code null}
     */
    static String format(final Descriptor descriptor) {
<span class="fc" id="L127">        Validate.notNull(descriptor, &quot;Parameter &gt;descriptor&lt; must not be null!&quot;);</span>
<span class="fc" id="L128">        final StringBuilder buffer = new StringBuilder(padUsage(descriptor.getUsage()));</span>
<span class="fc" id="L129">        boolean isFirstLine = true;</span>

<span class="fc bfc" id="L131" title="All 2 branches covered.">        for (final String line : StringUtils.split(wrap(descriptor.getHelpDescription()), NL)) {</span>
<span class="fc bfc" id="L132" title="All 2 branches covered.">            if (isFirstLine) {</span>
<span class="fc" id="L133">                buffer.append(line);</span>
<span class="fc" id="L134">                isFirstLine = false;</span>
            } else {
<span class="fc" id="L136">                buffer.append(StringUtils.repeat(&quot; &quot;, USAGE_WIDTH)).append(line);</span>
            }

<span class="fc" id="L139">            buffer.append(NL);</span>
        }

<span class="fc" id="L142">        return buffer.toString();</span>
    }

    private void commandHelp(final String command) {
        try {
<span class="nc" id="L147">            final Descriptor desc = CommandFactory.getDescriptor(command);</span>
<span class="nc" id="L148">            final StringBuilder buffer = new StringBuilder();</span>
<span class="nc" id="L149">            buffer.append(&quot;Help for command &quot;).append(desc.getCommand().toString()).append(&quot;:&quot;).append(NL).append(NL);</span>
<span class="nc" id="L150">            buffer.append(&quot;Usage: &quot;).append(desc.getUsage()).append(NL).append(NL);</span>
<span class="nc" id="L151">            buffer.append(WordUtils.wrap(desc.getHelpDescription(), MAX_WIDTH, NL, true)).append(NL);</span>
<span class="nc" id="L152">            println(buffer.toString());</span>
<span class="nc" id="L153">        } catch (final IllegalArgumentException ex) {</span>
<span class="nc" id="L154">            throw new CommandArgumentExcpetion(ex.getMessage());</span>
<span class="nc" id="L155">        } catch (IllegalAccessException| ClassNotFoundException | InstantiationException ex) {</span>
<span class="nc" id="L156">            throw new CommandRuntimeException(&quot;Can't get descriptors!&quot;, ex);</span>
<span class="nc" id="L157">        }</span>
<span class="nc" id="L158">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.5.201403032054</span></div></body></html>